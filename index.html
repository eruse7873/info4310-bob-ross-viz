<html>

<head>
    <link rel="stylesheet" href="styles.css">
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <script src="https://d3js.org/topojson.v3.min.js"></script>
</head>

<body>
    <h1>The Works of Bob Ross</h1>
    <p id=quote><q>We don't make mistakes, just happy little accidents.</q></p>

    <div class="icons">
        <!-- <img class="evergreen_icon" src="icons/icons8-evergreen-100.png" width="100" height="100"> -->
    </div>

    <!-- Referenced: https://www.w3schools.com/howto/howto_css_switch.asp -->
    <div class="frame_toggle">
        <div class="frame_heading">
            <h4> frame your work? </h4>
        </div>

        <label class="switch">
            <input type="checkbox" id="toggle" value="true" name="toggles">
            <span class="slider round">
            </span>
        </label>
    </div>

    <div class="container">

        <div class="left">

            <div class="canvas">
                <!-- <h2>Canvas</h2> -->
                <svg id="canvas" width=1000 height=700></svg>
            </div>
        </div>

        <div class="right">
            <div class="tutorials_head">
                <span class="percentage"></span> <span style="font-size: 20px;">Tutorials</span>

            </div>
            <div class="elements" id="elements"></div>
            <div class="tutorials">
                <table id="episode-table">
                    <thead>
                        <!-- <th style="width: 170px">Episode</th> -->
                        <th id="column"></th>
                        <!-- <th id="column">Episode</th> -->
                    </thead>
                </table>
            </div>
        </div>

    </div>
</body>

<script>
    const getData = async function () {

        let bob_ross = await d3.csv("bob_ross.csv", d3.autotype);
        let bob_ross_counts = await d3.csv("bob_ross_counts.csv", d3.autotype);

        console.log(bob_ross);
        console.log(bob_ross_counts);


        const canvas = d3.select("svg#canvas")
        const canvasHeight = canvas.attr("height")
        const canvasWidth = canvas.attr("width")

        var selectedLabels = [];

        canvas.append("svg:image")
            .attr("class", "mountain_drawing")
            .attr("width", 400)
            .attr("height", 500)
            .attr("xlink:href", "canvas/mountain.png")
            .attr("visibility", "visible")

        canvas.append("svg:image")
            .attr("class", "tree_drawing")
            .attr("width", 200)
            .attr("height", 600)
            .attr("xlink:href", "canvas/tree-1.png")
            .attr("visibility", "visible")


        canvas.append("svg:image")
            .attr("class", "fog_drawing")
            .attr("x", 500)
            .attr("y", 25)
            .attr("width", 600)
            .attr("height", 400)
            .attr("xlink:href", "canvas/fog.png")
            .attr("visibility", "visible")

        canvas.append("svg:image")
            .attr("class", "fog_drawing")
            .attr("x", 200)
            .attr("y", 0)
            .attr("width", 600)
            .attr("height", 400)
            .attr("xlink:href", "canvas/fog.png")
            .attr("visibility", "visible")

        canvas.append("svg:image")
            .attr("class", "fog_drawing")
            .attr("x", 150)
            .attr("y", 150)
            .attr("width", 400)
            .attr("height", 200)
            .attr("xlink:href", "canvas/fog.png")
            .attr("visibility", "visible")

        canvas.append("svg:image")
            .attr("class", "fog_drawing")
            .attr("x", 500)
            .attr("y", 120)
            .attr("width", 400)
            .attr("height", 200)
            .attr("xlink:href", "canvas/fog.png")
            .attr("visibility", "visible")

        canvas.append("svg:image")
            .attr("class", "bushes_drawing")
            .attr("x", 500)
            .attr("y", 500)
            .attr("width", 200)
            .attr("xlink:href", "canvas/bushes.png")
            .attr("visibility", "visible")

        canvas.append("svg:image")
            .attr("class", "building_drawing")
            .attr("x", 500)
            .attr("y", 500)
            .attr("width", 200)
            .attr("xlink:href", "canvas/building.png")
            .attr("visibility", "visible")

        canvas.append("svg:image")
            .attr("class", "flowers_drawing")
            .attr("x", 650)
            .attr("y", 500)
            .attr("width", 70)
            .attr("xlink:href", "canvas/flower.png")
            .attr("visibility", "visible")

        canvas.append("svg:image")
            .attr("class", "rocks_drawing")
            .attr("x", 700)
            .attr("y", 600)
            .attr("width", 70)
            .attr("xlink:href", "canvas/rocks.png")
            .attr("visibility", "visible")

        canvas.append("svg:image")
            .attr("class", "snow_drawing")
            .attr("x", 700)
            .attr("y", 600)
            .attr("width", 200)
            .attr("xlink:href", "canvas/snow.png")
            .attr("visibility", "visible")


        canvas.append("svg:image")
            .attr("class", "bridge_drawing")
            .attr("x", 700)
            .attr("y", 400)
            .attr("width", 200)
            .attr("xlink:href", "canvas/bridge.png")
            .attr("visibility", "visible")


        canvas.append("svg:image")
            .attr("class", "path_drawing")
            .attr("x", 700)
            .attr("y", 400)
            .attr("width", 200)
            .attr("xlink:href", "canvas/path.png")
            .attr("visibility", "visible")


            canvas.append("svg:image")
            .attr("x", 700)
            .attr("y", 500)
            .attr("width", 200)
            .attr("xlink:href", "canvas/fence.png")

            canvas.append("svg:image")
            .attr("x", 700)
            .attr("y", 500)
            .attr("width", 200)
            .attr("xlink:href", "canvas/fence.png")



            canvas.append("svg:image")
            .attr("x", 700)
            .attr("y", 200)
            .attr("width", 300)
            .attr("xlink:href", "canvas/cloud1.png")

            canvas.append("svg:image")
            .attr("x", 300)
            .attr("y", 200)
            .attr("width", 300)
            .attr("xlink:href", "canvas/cloud2.png")

            canvas.append("svg:image")
            .attr("x", 500)
            .attr("y", 200)
            .attr("width", 300)
            .attr("xlink:href", "canvas/cloud3.png")

            canvas.append("svg:image")
            .attr("x", 770)
            .attr("y", 50)
            .attr("width", 200)
            .attr("xlink:href", "canvas/sun.png")


            canvas.append("svg:image")
            .attr("x", 700)
            .attr("y", 200)
            .attr("width", 300)
            .attr("xlink:href", "canvas/cloud1.png")

            canvas.append("svg:image")
            .attr("x", 300)
            .attr("y", 200)
            .attr("width", 300)
            .attr("xlink:href", "canvas/cloud2.png")

            canvas.append("svg:image")
            .attr("x", 500)
            .attr("y", 200)
            .attr("width", 300)
            .attr("xlink:href", "canvas/cloud3.png")

            canvas.append("svg:image")
            .attr("x", 770)
            .attr("y", 50)
            .attr("width", 200)
            .attr("xlink:href", "canvas/sun.png")


        d3.select('.switch').on("change", function () {
            selected = d3.select("#toggle")._groups[0][0].checked;
            if (selected) {
                // referenced: https://gist.github.com/andrewStaroscik/5222370
                // toggle is on, create a frame
                var borderPath = canvas.append("rect")
                    .attr("class", "frame")
                    .attr("x", 0)
                    .attr("y", 0)
                    .attr("height", canvasHeight)
                    .attr("width", canvasWidth)
                    .style("stroke", "#de9000")
                    .style("fill", "none")
                    .style("stroke-width", 30);
                var borderPath2 = canvas.append("rect")
                    .attr("class", "frame")
                    .attr("x", 0)
                    .attr("y", 0)
                    .attr("height", canvasHeight)
                    .attr("width", canvasWidth)
                    .style("stroke", "gold")
                    .style("fill", "none")
                    .style("stroke-width", 20);

                // add "framed" to selectedLabels to update the table
                selectedLabels.push("framed")
                updateTable(selectedLabels);


            }
            else {
                //turn the frame off, if there is one
                canvas.selectAll('.frame').remove();
                selectedLabels.splice("framed")
                updateTable(selectedLabels);
            }
        })


        let f1ButtonsData = [];
        f1Label = ['tree', 'clouds', 'mountain', 'grass', 'lake', 'river', 'bushes', 'building', 'rocks', 'sun', 'waterfall', 'snow', 'path',
            'ocean', 'beach', 'fence', 'fog', 'night', 'flowers', 'bridge'];
        f1H2 = ["icons/tree.svg", "icons/clouds.svg", "icons/mountain.svg", "icons/grass.svg", "icons/lake.svg", "icons/river.svg", "icons/bushes.svg", "icons/building.svg",
            "icons/rocks.svg", "icons/sun.svg", "icons/waterfall.svg", "icons/snow.svg", "icons/path.svg", "icons/ocean.svg", "icons/beach.svg",
            "icons/fence.svg", "icons/fog.svg", "icons/night.svg", "icons/flowers.svg", "icons/bridge.svg"]
        // f1H3 = ['Markets', 'Cafes & Bakeries', 'Desserts & Drinks', 'Restaurant'] //h3 labels

        for (let i = 0; i < f1Label.length; i++) {
            dict = { label: f1Label[i], h2: f1H2[i] };

            // dict = { label: f1Label[i], h2: f1H2[i], h3: f1H3[i]};
            f1ButtonsData.push(dict);
        }

        console.log(f1ButtonsData)
        const f1div = d3.select('.icons')
        f1Buttons = f1div.selectAll('button').data(f1ButtonsData).join('button').on('click', iconClicked);


        console.log(f1Buttons)

        f1Buttons.append('img')
            .attr('width', 40)
            .attr('height', 40)
            .attr("src", d => d.h2)

        f1Buttons.append('h4').text(d => d.label);


        // reset button
        const resetButton = d3.select('div#header')
        resetButton.append('button').append('text').text("Reset Map").on('click', resetCanvas);

        function resetCanvas() {

            drawPoints(data);
            // f1Buttons.style('background-color', '#f0f0f0') // reset colors to default

        }

        function iconClicked() {
            console.log('triggered')
            console.log('iconClicked2')
            console.log(d3.select(this).datum().label)
            button = d3.select(this)
            button.style('background-color', '#fcf8cc')

            // label
            buttonClicked = d3.select(this).datum().label;
            buttonClickedIndex = selectedLabels.indexOf(buttonClicked)

            // if button is not in the selectedLabels, add it to the array
            if (buttonClickedIndex === -1) {
                selectedLabels.push(buttonClicked);
                // button.attr('class','buttonClicked')
                // probably call a function here to draw on the canvas
            }
            // if it is not in selectedLabels, remove it from the array
            // reset button bg color
            if (buttonClickedIndex > -1) {
                selectedLabels.splice(buttonClickedIndex, 1);
                // button.classed('buttonClicked',false)
                // button.classed('buttonUnclicked',true)
                console.log(button);
                button.style("background-color", "white")
                    // idk whyy but the css hover disappears afte
                    .on("mouseover", function () {
                        button.style("background-color", "#fcf8cc")
                            .on("mouseout", function () {
                                button.style("background-color", "white")
                            })
                    })
                // probably call a function here to remove it from the canvas
            }

            console.log('selectedLabels');
            console.log(selectedLabels);



            drawIcon(selectedLabels);
            updateTable(selectedLabels);
        }


    canvas.style("background-color", "#EEEEEE")

        function drawIcon(selectedButtons) {
            //should this function filter out the original dataset to just include the rows with that element?
            console.log('drawIcon');



            selectedButtons.forEach((d) => {

                if (d === 'night') {
                    canvas.style('background-color', '#00008B')
                }
                else {
                    className = '.' + d + '_drawing'

                    console.log('className')
                    console.log(className)

                    canvas.selectAll(className).attr("visibility", "visible");
                }
            })

            // console.log(d3.select(this));
        }



        // Populate the data table
        // updateTable( data )

        // Update data table with new rows and cells
        const episodeTable = d3.select("table#episode-table");

        function updateTable(selectedLabels) {
            console.log('updateTable')

            episodeTable.selectAll("td").remove();
            episodeTable.selectAll(".row").remove();
            d3.select(".element_list").remove();
            d3.select(".percentage text").remove();
            // d3.select(".tutorials_percent").remove();

            //buttonClicked is the icon that the user has selected
            //Need to take this label, filter the bob_ross data for rows where column: [label] is 1
            filteredData = Array.from(bob_ross)
            elementsText = "";
            selectedLabels.forEach((i) => {
                console.log(i);
                filteredData = filteredData.filter(d => d[i] == 1)
                label = i.charAt(0).toUpperCase() + i.substring(0 + 1)

                elementsText = elementsText + " " + label + ","


            })


            percentage = ((filteredData.length / bob_ross.length) * 100).toFixed(2) + '%';

            console.log(Number(filteredData.length / bob_ross.length).toFixed(2));

            d3.select(".percentage").append('text').attr("class", "tutorials_percent").text(percentage).style("font-size", 20);


            // d3.select(".tutorials_head").append('h2').attr("class", "tutorials_percent").text(percentage + " Tutorials");




            console.log('filteredData')
            console.log(filteredData);

            console.log('elementsText')
            console.log(elementsText)



            d3.select(".elements").append('h3').attr("class", "element_list").text("Contain Elements:" + elementsText.slice(0, -1));

            // First make table rows for each point using a data join 
            var tableRows = episodeTable.selectAll("tr.row").data(filteredData)
                .join(enter => {
                    // In the enter part, we add a <tr> and then three <td>
                    let newRows = enter.append("tr").attr("class", "row")

                    // newRows.append("td").text(d => d.title);
                    // newRows.append("td").text(d => d.episode);

                    cell = newRows.append("td").append("div").attr("class", "table_cell")

                    cell.append("img")
                        .attr("class", "cell_image")
                        .attr("src", d => 'paintings/' + d.episode + '.jpg');

                    cell.append("text")
                        .text(d => "Title: " + d.title)

                    cell.append("text")
                        .text(d => "Episode: " + d.episode)

                }
                    // update => {
                    //     // For each preexisting <tr>, clear out any <td> that exist there already just to make life easier
                    //     // Then repopulate them all over again
                    //     // update.selectAll("td").remove()

                    //     update.append("td").text(d => d.title);
                    //     update.append("td").text(d => d.episode);
                    //     //need a column for the element?
                    //     update.append("td").text(buttonClicked)

                    // }
                )
            console.log(tableRows)
        }
    }

    getData();

</script>


</html>